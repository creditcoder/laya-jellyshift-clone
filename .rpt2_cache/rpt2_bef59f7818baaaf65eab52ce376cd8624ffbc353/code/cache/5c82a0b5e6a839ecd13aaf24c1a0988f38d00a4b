{
  "code": "import GameInfo from \"./../script/GameInfo\";\r\nimport PlayerModel from \"./../script/Player\";\r\nexport default class TriggerCollisionScript extends Laya.Script3D {\r\n    constructor() {\r\n        super();\r\n        this.pillar_mat = null;\r\n        this.createdPieceTime = 0;\r\n    }\r\n    TriggerCollisionScript() {\r\n    }\r\n    onTriggerEnter(other) {\r\n        if (this.pillar_mat == null)\r\n            this.pillar_mat = this.owner.meshRenderer.material;\r\n        if (other.owner.name == \"jelly\") {\r\n            this.playerBody = other.owner;\r\n            if (!GameInfo.fever_ok) {\r\n                this.playerBody.getComponent(PlayerModel).bMoveState = false;\r\n                this.owner.event(\"trigger\", this.owner.parent.numChildren / 2);\r\n            }\r\n            this.explode();\r\n        }\r\n    }\r\n    createPiece(tmp, pillar_mat) {\r\n        var cubeSize = 0.2;\r\n        var piece = Laya.stage.getChildAt(0).addChild(new Laya.MeshSprite3D(Laya.PrimitiveMesh.createBox(cubeSize, cubeSize, cubeSize)));\r\n        piece.meshRenderer.material = pillar_mat;\r\n        piece.transform.position = tmp;\r\n        var rigidbd = piece.addComponent(Laya.Rigidbody3D);\r\n        var boxShape = new Laya.BoxColliderShape(cubeSize, cubeSize, cubeSize);\r\n        rigidbd.colliderShape = boxShape;\r\n        rigidbd.mass = cubeSize;\r\n        rigidbd.isTrigger = false;\r\n        return piece;\r\n    }\r\n    explode() {\r\n        var tmp = this.owner;\r\n        var pos = tmp.transform.position;\r\n        this.pieceArray = new Laya.MeshSprite3D();\r\n        this.pieceArray = this.createPiece(pos, this.pillar_mat);\r\n        var force = new Laya.Vector3(10, 10, 10);\r\n        this.createdPieceTime = Laya.timer.currTimer;\r\n        this.explosionRadiusCenter = this.playerBody.transform.position;\r\n        tmp.meshRenderer.enable = false;\r\n        tmp.getComponent(Laya.PhysicsCollider).enabled = false;\r\n    }\r\n    onUpdate() {\r\n        var explosionRadius = 2;\r\n        var explosionForce = 5;\r\n        if (GameInfo.fever_ok) {\r\n            explosionRadius = 5;\r\n            explosionForce = 5;\r\n        }\r\n        if (this.createdPieceTime > 0) {\r\n            if (Laya.Vector3.distance(this.pieceArray.transform.position, this.explosionRadiusCenter) <= explosionRadius) {\r\n                var force = new Laya.Vector3(0, 0, 0);\r\n                Laya.Vector3.subtract(this.pieceArray.transform.position, this.explosionRadiusCenter, force);\r\n                var rbd = this.pieceArray.getComponent(Laya.Rigidbody3D);\r\n                Laya.Vector3.scale(force, (explosionForce), force);\r\n                var rnd = new Laya.Rand(this.pieceArray.transform.position.x * this.pieceArray.transform.position.y * 1000);\r\n                var delta = rnd.getUint() % 5;\r\n                force.z -= delta / 10;\r\n                force.y += delta;\r\n                rbd.applyForce(force);\r\n            }\r\n        }\r\n        if (this.createdPieceTime > 0 && Laya.timer.currTimer - this.createdPieceTime > 1500) {\r\n            this.pieceArray.active = false;\r\n            this.pieceArray.meshRenderer.enable = false;\r\n            this.pieceArray.destroy();\r\n            this.pieceArray = null;\r\n            this.createdPieceTime = 0;\r\n            this.owner.destroy();\r\n        }\r\n    }\r\n    onTriggerStay(other) {\r\n    }\r\n    onTriggerExit(other) {\r\n    }\r\n    onCollisionEnter(collision) {\r\n    }\r\n    onCollisionStay(collision) {\r\n    }\r\n    onCollisionExit(collision) {\r\n    }\r\n}\r\n",
  "references": [
    "F:/zzz/laya-jellyshift-clone/src/script/GameInfo.ts",
    "F:/zzz/laya-jellyshift-clone/src/script/GameUI.ts",
    "F:/zzz/laya-jellyshift-clone/src/script/Player.ts"
  ]
}

{
  "code": "import GameInfo from \"./../script/gameInfo\";\r\nexport default class Food extends Laya.Script3D {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.scene = null;\r\n        this.model = null;\r\n        this.is_start = false;\r\n        this.velocity = 0.5;\r\n        this.camera = null;\r\n        this.curr_round = 0;\r\n        this.y_delta = 2.5;\r\n        this.bCustomize = false;\r\n        this.current_dir = \"z\";\r\n    }\r\n    onAwake() {\r\n        this.model = this.owner;\r\n        this.curr_round = parseInt(localStorage.getItem(\"jelly_round\")) + 1;\r\n        let planeStaticCollider = this.model.addComponent(Laya.PhysicsCollider);\r\n        planeStaticCollider.colliderShape = new Laya.BoxColliderShape(3, 3, 3);\r\n        planeStaticCollider.friction = 2;\r\n        planeStaticCollider.restitution = 0.3;\r\n        planeStaticCollider.isTrigger = false;\r\n    }\r\n    isCurveLevel() {\r\n        let ret = false;\r\n        if (this.curr_round > 3)\r\n            ret = ((this.curr_round + 1) % 4 == 0);\r\n        return ret;\r\n    }\r\n    startFollow(sprite, cam) {\r\n        this.scene = sprite;\r\n        this.camera = cam;\r\n    }\r\n    updateGameState(game_state) {\r\n        GameInfo.GAME_STATE = game_state;\r\n    }\r\n    updatePassLen(pass_len) {\r\n        GameInfo.curFoodLen = pass_len;\r\n    }\r\n    start() {\r\n        this.is_start = true;\r\n    }\r\n    updateCustomState(state) {\r\n        this.bCustomize = state;\r\n    }\r\n    onUpdate() {\r\n        if (GameInfo.GAME_STATE == 2 || this.bCustomize) {\r\n            return;\r\n        }\r\n        if (!this.is_start)\r\n            return;\r\n        if (GameInfo.curFoodLen > 10) {\r\n            this.velocity = 0.205;\r\n            if (this.y_delta != 0.8) {\r\n                this.y_delta -= 0.01;\r\n                if (this.y_delta < 0.8)\r\n                    this.y_delta = 0.8;\r\n            }\r\n        }\r\n        else {\r\n            this.velocity = 0.4;\r\n        }\r\n        if (this.isCurveLevel()) {\r\n        }\r\n        let y_pos = this.y_delta + Math.sin(this.model.transform.localPositionZ / 2) * 0.2;\r\n        if (this.current_dir == \"z\") {\r\n            this.model.transform.localPosition = new Laya.Vector3(this.model.transform.localPositionX, y_pos, this.model.transform.localPositionZ + this.velocity);\r\n        }\r\n        else if (this.current_dir == \"x\") {\r\n            this.model.transform.localPosition = new Laya.Vector3(this.model.transform.localPositionX - this.velocity, y_pos, this.model.transform.localPositionZ);\r\n        }\r\n        this.updateGameInfo();\r\n    }\r\n    updateGameInfo() {\r\n        let maxlen = GameInfo.getTerrainLength(this.curr_round);\r\n        if (GameInfo.curFoodLen > maxlen)\r\n            GameInfo.curFoodLen = maxlen;\r\n        else\r\n            GameInfo.curFoodLen += this.velocity;\r\n        let cur_per = GameInfo.curFoodLen / maxlen;\r\n        if (cur_per > 0.3)\r\n            this.velocity = 0.09;\r\n        this.owner.event(\"update_path\", cur_per);\r\n    }\r\n    onDestroy() {\r\n    }\r\n    onCollisionEnter(collision) {\r\n        if (collision.other.owner.name == \"jelly\") {\r\n            this.owner.event(\"food_destroy\");\r\n            this.model.destroy();\r\n        }\r\n    }\r\n    onTriggerEnter(other) {\r\n        if (other.owner == null)\r\n            return;\r\n    }\r\n    ShowEatParticle(model) {\r\n        let particles = Laya.loader.getRes(\"unity/model/particle.lh\");\r\n        let tmp = particles.getChildAt(1);\r\n        if (!tmp) {\r\n            return;\r\n        }\r\n        var dup = Laya.MeshSprite3D.instantiate(tmp);\r\n        this.model.addChild(dup);\r\n        dup.transform.localPosition = new Laya.Vector3(0, 0, 0);\r\n        var delta = new Laya.Vector3(0, 0, 0);\r\n        Laya.Vector3.subtract(this.camera.transform.position, model.transform.position, delta);\r\n        Laya.Vector3.normalize(delta, delta);\r\n        Laya.Vector3.scale(delta, 5, delta);\r\n        Laya.Vector3.add(dup.transform.position, delta, dup.transform.position);\r\n        dup.transform.localScale = new Laya.Vector3(2, 2, 2);\r\n        dup.active = true;\r\n    }\r\n    ShowEndParticle() {\r\n        let particles = Laya.loader.getRes(\"unity/model/particle.lh\");\r\n        let tmp = particles.getChildAt(0);\r\n        if (!tmp) {\r\n            return;\r\n        }\r\n        var dup = Laya.MeshSprite3D.instantiate(tmp);\r\n        this.model.addChild(dup);\r\n        dup.transform.localPosition = new Laya.Vector3(0, 0, 0);\r\n        var delta = new Laya.Vector3(0, 0, 0);\r\n        Laya.Vector3.subtract(this.camera.transform.position, this.model.transform.position, delta);\r\n        Laya.Vector3.normalize(delta, delta);\r\n        Laya.Vector3.scale(delta, 5, delta);\r\n        Laya.Vector3.add(dup.transform.position, delta, dup.transform.position);\r\n        dup.transform.localScale = new Laya.Vector3(2, 2, 2);\r\n        dup.active = true;\r\n    }\r\n    ShowRibonParticle(model) {\r\n        let particles = Laya.loader.getRes(\"unity/model/particle.lh\");\r\n        let tmp = particles.getChildAt(0);\r\n        if (!tmp) {\r\n            return;\r\n        }\r\n        var dup = Laya.MeshSprite3D.instantiate(tmp);\r\n        model.addChild(dup);\r\n        dup.transform.localPosition = new Laya.Vector3(0, 0, 0);\r\n        dup.transform.localPosition.y += 0.5;\r\n        let self = this;\r\n        Laya.timer.once(1500, this, function () {\r\n            model.removeChild(dup);\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "F:/zzz/laya-jellyshift-clone/src/script/gameInfo.ts"
  ]
}
